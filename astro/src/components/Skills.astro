---
import SkillBox from './SkillBox.astro';
import skillsData from '../data/skills.json';

// Type assertion for skills data
interface Skill {
	id: number;
	name: string;
	svgPath: string;
}

interface SkillsData {
	[category: string]: Skill[];
}

const skills = skillsData as SkillsData;
const categories = Object.keys(skills);
---

<section class="min-h-screen w-full flex flex-col justify-center py-12" style="background-color: var(--color-Background1);">
	<!-- Title section (top) -->
	<div class="mb-12 text-center px-4">
		<h2 class="text-5xl font-Display1 mb-2" style="color: var(--color-Neutral-Dark);">Skills</h2>
		<p class="text-lg font-Display2 text-gray-500">Always Improving</p>
	</div>

	<!-- Container full width, no rounding -->
	<div class="w-full h-auto min-h-[70vh] shadow-lg p-12" style="background-color: var(--color-Background2);">
		<div class="max-w-6xl mx-auto space-y-12">
			{categories.map((category) => (
				<div>
					<!-- Category heading -->
					<h3 class="text-2xl font-Display1 mb-6 text-center" style="color: var(--color-Neutral-Dark);">
						{category}
					</h3>
					
					<!-- Skills grid for this category -->
					<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-4 gap-6">
						{skills[category].map((skill) => (
							<SkillBox
								svgPath={skill.svgPath}
								name={skill.name}
							/>
						))}
					</div>
				</div>
			))}
		</div>
	</div>
</section>

<script>
	// Hotspot bar configuration: 40-60% of viewport height
	const HOTSPOT_TOP = 0.3;
	const HOTSPOT_BOTTOM = 0.8;

	function updateSkillBoxes() {
		const viewportHeight = window.innerHeight;
		const hotspotTop = viewportHeight * HOTSPOT_TOP;
		const hotspotBottom = viewportHeight * HOTSPOT_BOTTOM;

		const skillBoxes = document.querySelectorAll('[data-skill]');

		skillBoxes.forEach((box) => {
			const rect = box.getBoundingClientRect();
			const boxCenter = rect.top + rect.height / 2;

			// Check if box center is within the hotspot bar
			if (boxCenter >= hotspotTop && boxCenter <= hotspotBottom) {
				box.classList.add('active');
			} else {
				box.classList.remove('active');
			}
		});
	}

	// Run on load and scroll
	document.addEventListener('DOMContentLoaded', updateSkillBoxes);
	window.addEventListener('scroll', updateSkillBoxes);
	window.addEventListener('resize', updateSkillBoxes);
</script>
